{{template "_head" .}}
<div class="admin user">
    <div class="ui container">
        <div class="ui grid">
        {{template "_left" .}}
			<div class="user signup">
				<div class="ui middle very relaxed page grid">
					<div class="" >
						<form class="ui form" action="{{.Link}}" method="post">
							<h3 class="ui top attached header">
								{{.i18n.Tr "Edit Scheduled Task"}}
							</h3>
							<div class="ui attached segment">
								<div class="required inline field">
									<label for="name">{{.i18n.Tr "Name"}}</label>
									<input id="name" name="name" value="{{.Task.Name}}" autofocus required>
								</div>
								<div class="required inline field">
									<label for="task_type">{{.i18n.Tr "Task Type"}}</label>
									<select name="task_type" id="task_type" class="ui selection dropdown">
                                         <option value="instance_op" {{if eq .Task.TaskType "instance_op"}}selected{{end}}>Instance Operation</option>
                                         <option value="volume_backup" {{if eq .Task.TaskType "volume_backup"}}selected{{end}}>Volume Backup</option>
                                    </select>
								</div>
								<div class="required inline field">
									<label for="resource_type">{{.i18n.Tr "Resource Type"}}</label>
									<select name="resource_type" id="resource_type" class="ui selection dropdown">
                                         <option value="instance" {{if eq .Task.ResourceType "instance"}}selected{{end}}>Instance</option>
                                         <option value="volume" {{if eq .Task.ResourceType "volume"}}selected{{end}}>Volume</option>
                                    </select>
								</div>
								<div class="required inline field">
									<label for="resource_id">{{.i18n.Tr "Resource ID"}}</label>
									<select name="resource_id" id="resource_id" class="ui selection dropdown">
										{{if eq .Task.ResourceType "instance"}}
											{{range .Instances}}
												<option value="{{.ID}}" {{if eq .ID .Task.ResourceID}}selected{{end}}>{{.Name}}</option>
											{{end}}
										{{else if eq .Task.ResourceType "volume"}}
											{{range .Volumes}}
												<option value="{{.ID}}" {{if eq .ID .Task.ResourceID}}selected{{end}}>{{.Name}}</option>
											{{end}}
										{{end}}
                                    </select>
								</div>
								<div class="required inline field">
									<label for="operation">{{.i18n.Tr "Operation"}}</label>
									<input id="operation" name="operation" value="{{.Task.Operation}}" required>
								</div>
								<div class="required inline field">
									<label for="schedule_type">{{.i18n.Tr "Schedule Type"}}</label>
									<select name="schedule_type" id="schedule_type" class="ui selection dropdown">
                                         <option value="one-time" {{if eq .Task.ScheduleType "one-time"}}selected{{end}}>One Time</option>
                                         <option value="daily" {{if eq .Task.ScheduleType "daily"}}selected{{end}}>Daily</option>
                                         <option value="weekly" {{if eq .Task.ScheduleType "weekly"}}selected{{end}}>Weekly</option>
                                         <option value="monthly" {{if eq .Task.ScheduleType "monthly"}}selected{{end}}>Monthly</option>
                                    </select>
								</div>
								<div class="inline field">
									<label for="execution_time">{{.i18n.Tr "Execution Time"}}</label>
									<input id="execution_time" name="execution_time" value="{{.Task.ExecutionTime.Format "2006-01-02T15:04"}}" type="datetime-local">
								</div>
								<div class="inline field">
									<label for="cron_expression">{{.i18n.Tr "Cron Expression"}}</label>
									<input id="cron_expression" name="cron_expression" value="{{.Task.CronExpression}}">
								</div>
								<div class="inline field">
									<label for="retention_count">{{.i18n.Tr "Retention Count"}}</label>
									<input id="retention_count" name="retention_count" value="{{.Task.RetentionCount}}">
								</div>
								<div class="required inline field">
									<label for="status">{{.i18n.Tr "Status"}}</label>
									<select name="status" id="status" class="ui selection dropdown">
                                         <option value="enabled" {{if eq .Task.Status "enabled"}}selected{{end}}>Enabled</option>
                                         <option value="disabled" {{if eq .Task.Status "disabled"}}selected{{end}}>Disabled</option>
                                    </select>
								</div>
								<div class="inline field">
									<label></label>
									<button class="ui green button">{{.i18n.Tr "Update"}}</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		</div>
	</div>
</div>
{{template "_footer" .}}
<script>
$('#task_type').on('change', function() {
    var taskType = $(this).val();
    if (taskType === 'instance_op') {
        $('#resource_type').val('instance').change();
        $('#resource_type option[value="instance"]').prop('selected', true);
        $('#resource_type option[value="volume"]').prop('selected', false);
        $('#resource_type').parent().dropdown('set selected', 'instance');
    } else if (taskType === 'volume_backup') {
        $('#resource_type').val('volume').change();
        $('#resource_type option[value="volume"]').prop('selected', true);
        $('#resource_type option[value="instance"]').prop('selected', false);
        $('#resource_type').parent().dropdown('set selected', 'volume');
    }
});

$('#resource_type').on('change', function() {
    var resourceType = $(this).val();
    var resourceIdDropdown = $('#resource_id');
    resourceIdDropdown.empty();
    if (resourceType === 'instance') {
        {{range .Instances}}
            resourceIdDropdown.append($('<option>', {
                value: {{.ID}},
                text: '{{.Name}}'
            }));
        {{end}}
    } else if (resourceType === 'volume') {
        {{range .Volumes}}
            resourceIdDropdown.append($('<option>', {
                value: {{.ID}},
                text: '{{.Name}}'
            }));
        {{end}}
    }
    resourceIdDropdown.parent().dropdown('set selected', resourceIdDropdown.val());
});

// Trigger change on load to populate resource_id dropdown
$(document).ready(function() {
    $('#resource_type').change();
});
</script>
