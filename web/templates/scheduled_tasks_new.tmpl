{{template "_head" .}}
<div class="admin user">
    <div class="ui container">
        <div class="ui grid">
        {{template "_left" .}}
			<div class="user signup">
				<div class="ui middle very relaxed page grid">
					<div class="" >
						<form class="ui form" action="{{.Link}}" method="post">
							<h3 class="ui top attached header">
								{{.i18n.Tr "Create New Scheduled Task"}}
							</h3>
							<div class="ui attached segment">
								<div class="required inline field">
									<label for="name">{{.i18n.Tr "Name"}}</label>
									<input id="name" name="name" autofocus required>
								</div>
								<div class="required inline field">
									<label for="task_type">{{.i18n.Tr "Task Type"}}</label>
									<select name="task_type" id="task_type" class="ui selection dropdown">
                                         <option value="instance_op" selected>Instance Operation</option>
                                         <option value="volume_backup">Volume Backup</option>
                                    </select>
								</div>
								<div class="required inline field">
									<label for="resource_type">{{.i18n.Tr "Resource Type"}}</label>
									<select name="resource_type" id="resource_type" class="ui selection dropdown">
                                         <option value="instance" selected>Instance</option>
                                         <option value="volume">Volume</option>
                                    </select>
								</div>
								<div class="required inline field">
									<label for="resource_id">{{.i18n.Tr "Resource ID"}}</label>
									<select name="resource_id" id="resource_id" class="ui selection dropdown">
										{{range .Instances}}
											<option value="{{.ID}}">{{.Name}}</option>
										{{end}}
                                    </select>
								</div>
								<div class="required inline field">
									<label for="operation">{{.i18n.Tr "Operation"}}</label>
									<select name="operation" id="operation" class="ui selection dropdown">
                                         <option value="stop" selected>Stop</option>
                                         <option value="hard_stop">Hard Stop</option>
                                         <option value="start">Start</option>
                                         <option value="restart">Restart</option>
                                         <option value="hard_restart">Hard Restart</option>
                                         <option value="snapshot">Snapshot</option>
                                         <option value="backup">Backup</option>
                                    </select>
								</div>
								<div class="required inline field">
									<label for="schedule_type">{{.i18n.Tr "Schedule Type"}}</label>
									<select name="schedule_type" id="schedule_type" class="ui selection dropdown">
                                         <option value="one-time" selected>One Time</option>
                                         <option value="daily">Daily</option>
                                         <option value="weekly">Weekly</option>
                                         <option value="monthly">Monthly</option>
                                    </select>
								</div>
								<div class="inline field">
									<label for="execution_time">{{.i18n.Tr "Execution Time"}}</label>
									<input id="execution_time" name="execution_time" type="datetime-local">
								</div>
								<div class="inline field">
									<label for="cron_expression">{{.i18n.Tr "Cron Expression"}}</label>
									<input id="cron_expression" name="cron_expression">
								</div>
								<div class="inline field">
									<label for="retention_count">{{.i18n.Tr "Retention Count"}}</label>
									<input id="retention_count" name="retention_count" value="0">
								</div>
								<div class="inline field">
									<label></label>
									<button class="ui green button">{{.i18n.Tr "Create"}}</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{{template "_footer" .}}
<script>
$('#task_type').on('change', function() {
    var taskType = $(this).val();
    if (taskType === 'instance_op') {
        $('#resource_type').val('instance').change();
        $('#resource_type option[value="instance"]').prop('selected', true);
        $('#resource_type option[value="volume"]').prop('selected', false);
        $('#resource_type').parent().dropdown('set selected', 'instance');
    } else if (taskType === 'volume_backup') {
        $('#resource_type').val('volume').change();
        $('#resource_type option[value="volume"]').prop('selected', true);
        $('#resource_type option[value="instance"]').prop('selected', false);
        $('#resource_type').parent().dropdown('set selected', 'volume');
    }
});

$('#resource_type').on('change', function() {
    var resourceType = $(this).val();
    var resourceIdDropdown = $('#resource_id');
    resourceIdDropdown.empty();
    if (resourceType === 'instance') {
        {{range .Instances}}
            resourceIdDropdown.append($('<option>', {
                value: {{.ID}},
                text: '{{.Name}}'
            }));
        {{end}}
    } else if (resourceType === 'volume') {
        {{range .Volumes}}
            resourceIdDropdown.append($('<option>', {
                value: {{.ID}},
                text: '{{.Name}}'
            }));
        {{end}}
    }
    resourceIdDropdown.parent().dropdown('set selected', resourceIdDropdown.val());
});

// Trigger change on load to populate resource_id dropdown
$(document).ready(function() {
    $('#resource_type').change();
});
</script>
