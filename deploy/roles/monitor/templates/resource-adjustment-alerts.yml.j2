groups:
- name: resource_adjustment_alerts_{{ rule_group }}
  rules:
  - alert: ResourceAdjustment_LimitCPU_{{ rule_group }}
    expr: vm_requires_cpu_limit_{{ rule_group }} > 0
    for: {{ trigger_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: limit_cpu
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM requires CPU limitation"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} requires CPU limitation"

  - alert: ResourceAdjustment_RestoreCPU_{{ rule_group }}
    expr: vm_ready_for_cpu_restore_{{ rule_group }} > 0
    for: {{ restore_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: restore_cpu
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM ready for CPU restoration"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} is ready for CPU restoration"
      
  - alert: ResourceAdjustment_LimitInBW_{{ rule_group }}
    expr: vm_requires_in_bw_limit_{{ rule_group }} > 0
    for: {{ trigger_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: limit_in_bw
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM requires inbound bandwidth limitation"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} requires inbound bandwidth limitation"
      
  - alert: ResourceAdjustment_RestoreInBW_{{ rule_group }}
    expr: vm_ready_for_in_bw_restore_{{ rule_group }} > 0
    for: {{ restore_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: restore_in_bw
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM ready for inbound bandwidth restoration"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} is ready for inbound bandwidth restoration"
      
  - alert: ResourceAdjustment_LimitOutBW_{{ rule_group }}
    expr: vm_requires_out_bw_limit_{{ rule_group }} > 0
    for: {{ trigger_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: limit_out_bw
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM requires outbound bandwidth limitation"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} requires outbound bandwidth limitation"
      
  - alert: ResourceAdjustment_RestoreOutBW_{{ rule_group }}
    expr: vm_ready_for_out_bw_restore_{{ rule_group }} > 0
    for: {{ restore_duration }}s
    labels:
      severity: info
      alert_type: resource_adjustment
      action_type: restore_out_bw
      rule_group: "{{ rule_group_original }}"
      global_rule_id: "{{ global_rule_id }}"
      owner: "{{ owner }}"
      email: "{{ email | default('') }}"
      adjust_enabled: "{{ adjust_enabled | default('true') }}"
      matched: "{{ if $labels.rule_id }}true{{ else }}false{{ end }}"
    annotations:
      summary: "VM ready for outbound bandwidth restoration"
      description: "VM {{ "{{ $labels.domain }}" }} with rule {{ "{{ $labels.rule_id }}" }} is ready for outbound bandwidth restoration"
