groups:
- name: ipgroup-available-ip-monitor
  rules:
    - alert: IPGroupLowAvailableIPs
      # Monitor available IP count in subnets
      expr: |
        (
          cloudland_subnet_ip_available < {{ threshold | default(100) }}
        )
        * on (ipgroup_id, subnet_id, region)
          group_left(ipgroup_name)
          cloudland_subnet_info
      for: {{ for_duration | default("5m") }}
      labels:
        severity: {{ severity | default("warning") }}
        component: network
        alert_type: ipgroup_low_ips
      annotations:
        summary: "IP Group {{ $labels.ipgroup_name }} - Low Available IPs in subnets:({{ $labels.subnet_name }})"
        description: |
          IP Group: {{ $labels.ipgroup_name }} ({{ $labels.ipgroup_id }})
          Subnet: {{ $labels.subnet_name }} ({{ $labels.subnet_id }})
          Region: {{ $labels.region }}
          Available IPs: {{ $value }}
          This subnet has fallen below the configured threshold of {{ threshold | default(100) }} available IP addresses.
