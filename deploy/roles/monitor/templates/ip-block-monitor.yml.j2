groups:
- name: ip-blocking-monitor
  rules:
    - alert: IPBlocked
      # Monitor blocked IPs from ipset
      expr: ipset_blocked_ips == 1
      for: {{ for_duration | default("30s") }}
      labels:
        # Dynamic labels from metrics
        severity: {{ severity | default("warning") }}
        component: network
        alert_type: ip_blocked
        ip: "{{ $labels.ip }}"
        hostname: "{{ $labels.hostname }}"
      annotations:
        summary: "IP {{ $labels.ip }} is currently blocked on {{ $labels.hostname }}"
        description: |
          IP address {{ $labels.ip }} is currently in the ipset blacklist on host {{ $labels.hostname }} due to suspicious network activity detected by conntrack monitoring.
